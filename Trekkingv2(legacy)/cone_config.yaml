# Cone detection and tracking configuration for MP4 video input
# This configuration is optimized for running with offline video files
# and provides debug output to the terminal without GUI windows.

# Camera/Video Input Configuration
camera:
  # Path to your MP4 video file (update this to point to your video)
  video_path: ""
  
  # Path to save processed output video (leave empty to not save)
  output_video_path: ""
  
  # Camera index (only used if video_path is empty or file not found)
  index: 
  
  # Processing resolution - frames are resized to this resolution
  # These values balance performance and detection quality for typical videos
  process_width: 960
  process_height: 540
  
  # Target FPS (for camera mode; video mode uses source FPS)
  fps: 30
  
  # Horizontal field of view in degrees (used for heading angle calculations)
  # Typical webcams: 60-90°, action cameras: 120-170°, phone cameras: 70-80°
  # Adjust this to match your camera/video source for accurate angle estimates
  hfov_deg: 70.0

# Debug and Visualization Settings
debug:
  # Show OpenCV windows (set to false for headless/server environments)
  show_windows: false
  
  # Show HSV mask window for color tuning
  show_mask: false
  
  # Print heading/steering debug info to terminal (HEADING_DBG messages)
  # When enabled, prints detected cone position, heading error in degrees, and estimated distance
  print_heading: true
  
  # Real-world cone height in meters (used for distance estimation in debug prints)
  # Standard traffic cone: ~0.28m, construction cone: ~0.45-0.70m
  # If not provided or set to null, distance estimation is skipped
  cone_height_m: 0.28
  
  # Draw suspect tracks in yellow (in addition to confirmed green tracks)
  draw_suspects: true
  
  # Show rejection reasons in visualizer overlay
  show_rejection_reason: false

  # Export debug CSV logs per frame
  csv_export:
    enabled: false
    csv_dir: "logs/csv"
    filename_pattern: "run_{source}_{start_ts}.csv"
    flush_every_frames: 10
    include_header: true
    mode: "normalized"
    fields:
      - frame_idx
      - ts_wallclock_ms
      - ts_source_ms
      - source
      - detected
      - target_id
      - cx
      - cy
      - err_px
      - err_norm
      - err_deg
      - bbox_h
      - est_dist_m
      - avg_score
      - fps
    normalize:
      rule: "none"
    clamp_range: [-1.0, 1.0]

# Tracking Configuration
# These settings control how the multi-object tracker associates and confirms cone detections
tracking:
  # Maximum time (seconds) a track can go without updates before deletion
  # Higher values help maintain tracks through brief occlusions
  lost_timeout: 3.0
  
  # Maximum distance (pixels) for associating a new detection to an existing track
  # Higher values allow tracking objects with larger frame-to-frame movement
  association_max_distance: 250
  
  # Minimum number of consecutive frames required to confirm a track
  # Lower values confirm faster but may increase false positives
  min_frames_for_confirm: 4
  
  # Exponential moving average smoothing factor (0-1)
  # Higher = more responsive to changes, lower = smoother but slower to adapt
  ema_alpha: 0.35
  
  # Grace period (frames) for confirmed tracks that lose detections
  # Tracks remain CONFIRMED for this many frames without updates before reverting to SUSPECT
  grace_frames: 20
  
  # Maximum number of simultaneous tracks
  max_tracks: 8
  
  # Number of recent frames to use for score averaging
  score_window: 10

# Geometry Filter Configuration
# These thresholds control when a track is confirmed and what detections are accepted
geometry:
  # Average score threshold for confirming a track
  # Track becomes CONFIRMED when avg score over score_window frames >= this value
  confirm_avg_score: 0.50
  
  # Minimum score for a single frame detection to be accepted
  # Detections below this are rejected immediately
  min_frame_score: 0.30
